# Notification

記事やウェブページなどを公開・更新時にメールを送信する

## 動作環境

- PowerCMS がインストールされている環境

## インストール

1. PowerCMS のプラグインディレクトリへ Notification を配置する
2. PowerCMS 管理画面へログインし、システムレベルのプラグイン設定画面に Notification が追加されていることを確認する

※ PowerCMS を PSGI や FastCGI で動作させている場合、プラグインの配置後に PSGI や FastCGI の再起動の操作が必要です。再起動が必要かはサーバー管理者へ確認してください。

## 設定

### 環境変数

- NotificationObjectClasses

   どの種類のデータが公開・更新されたときにメールを送信するか設定します。カンマ区切りで複数の指定できます。
   (初期値: entry,page)

- NotificationAtStatusChanged

   公開時と更新時、どちらの場合にメール送信するか設定します
   1 を指定すると公開時にメールを送信し、0 を指定すると更新時にメールを送信します。 (初期値: 1)

   更新時にメールを送信する場合に、大量のメールが送信される可能性があることに注意してください。

### プラグイン設定

- メールの件名

  ここに指定した内容がメールの件名になります

- メールの本文

  ここに指定した内容がメールの本文になります。下記のデフォルトの設定では、変数 body がメール本文用のカスタムフィールドに入力された値を出力します。

    <mt:var name="body">

  ここではいくつかのテンプレート変数を利用することで記事などの情報を出力できます。

    object_title = 記事のタイトル
    permalink = 記事の URL

### カスタムフィールド

カスタムフィールドでメール通知の本文と宛先(To)を指定します。
カスタムフィールドはメール送信のきっかけになるデータに対して設定を行います。

例えば記事の公開時にメールを送信したい場合は記事に対して下記のようなカスタムフィールドを設定してください。

設定の中で重要になるのはベースネームです。
記事の場合は entry_notification_body と entry_notification_email を指定し、ウェブページの場合は entry_ の部分を page_ に置き換えて設定してください。

#### メール本文用のカスタムフィールド (記事)

- システムオブジェクト
  - 記事
- 名前
  - メール本文(任意)
- 説明
  - メールの本文に記載したい内容を入力してください (任意)
- 種類
  - 複数行テキスト
- 必須
  -  (任意)
- 規定値
  -  (任意)
- ベースネーム
  -  entry_notification_body
- テンプレートタグ
  - (任意)

#### メール宛先(To)用のカスタムフィールド (記事)

- システムオブジェクト
  - 記事
- 名前
  - メール通知先(任意)
- 説明
  - メールの宛先(To) にしたいメールアドレスをカンマ区切りで入力してください (任意)
- 種類
  - テキスト
- 必須
  - (任意)
- 規定値
  - (任意)
- ベースネーム
  - entry_notification_email
- テンプレートタグ
  - (任意)

## 使い方

記事などメール送信のきっかけとなるデータを公開・更新する操作を行ったとき、カスタムフィールドで指定した宛先に対してメールが送信されます。

1. 記事の作成・編集画面を開く
2. タイトルなど記事のデータを入力する
3. カスタムフィールド「メール本文」へメールの本文に記載したい内容を入力する
4. カスタムフィールド「メール通知先」へメールの宛先 (To) にしたいメールアドレスを入力する
5. ステータスを「公開」にして保存する

## 更新履歴

- バージョン 0.22 (2013/02/19)
  - PSGI 環境でエラーが発生して動作しない問題に対策
- バージョン 0.21 (2013/02/18)
- バージョン 0.2 (2013/02/16)
- バージョン 0.1 (2013/02/16)
  - 完成

## 奥付
- Alfasado Inc.
- https://alfasado.net/
